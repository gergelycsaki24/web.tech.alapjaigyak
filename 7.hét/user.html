<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git App - User Profile</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .col {
            flex: 1;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="profile-header">
        <img id="avatar" class="avatar" src="" alt="User avatar">
        <div>
            <h2 id="username"></h2>
            <p id="bio"></p>
            <p id="location"></p>
            <p id="blog"></p>
        </div>
    </div>

    <div class="container">
        <div class="col">
            <h4>Repositories</h4>
            <ul id="repos"></ul>
        </div>
        <div class="col">
            <h4>Followers</h4>
            <ul id="followers"></ul>
        </div>
        <div class="col">
            <h4>Following</h4>
            <ul id="following"></ul>
        </div>
    </div>

    <script>
        async function loadUserProfile(username) {
            try {
                const res = await fetch(`https://api.github.com/users/${username}`, {
                    headers: {
                        'Authorization': 'Bearer ' + GITHUB_ACCESS_TOKEN
                    }
                });

                if (!res.ok) {
                    throw 'Server error occurred, status code:' + res.status;
                }
                const data = await res.json();
                
                document.querySelector('#username').textContent = data.name || data.login;
                document.querySelector('#bio').textContent = data.bio || 'No bio available';
                document.querySelector('#location').textContent = data.location || 'Location not specified';
                document.querySelector('#avatar').src = data.avatar_url;
                
                if (data.blog) {
                    document.querySelector('#blog').innerHTML = 
                        `<a href="${data.blog.startsWith('http') ? data.blog : 'https://' + data.blog}" target="_blank">${data.blog}</a>`;
                }

            } catch (err) {
                if (typeof err == 'string') {
                    alert(err);
                }
                console.error(err);
            }
        }

        async function loadRepositories(username) {
            try {
                const res = await fetch(`https://api.github.com/users/${username}/repos`, {
                    headers: {
                        'Authorization': 'Bearer ' + GITHUB_ACCESS_TOKEN
                    }
                });

                if (!res.ok) {
                    throw 'Server error occurred, status code:' + res.status;
                }
                const data = await res.json();
                const reposList = document.querySelector('#repos');
                
                data.forEach(repo => {
                    const repoHtml = `
                    <li>
                        <strong><a href="${repo.html_url}" target="_blank">${repo.name}</a></strong>
                        <p>${repo.description || 'No description'}</p>
                        <small>‚≠ê ${repo.stargazers_count} | üç¥ ${repo.forks_count}</small>
                    </li>
                    `;
                    reposList.innerHTML += repoHtml;
                });
            } catch (err) {
                console.error(err);
            }
        }

        async function loadFollowers(username) {
            try {
                const res = await fetch(`https://api.github.com/users/${username}/followers`, {
                    headers: {
                        'Authorization': 'Bearer ' + GITHUB_ACCESS_TOKEN
                    }
                });

                if (!res.ok) {
                    throw 'Server error occurred, status code:' + res.status;
                }
                const data = await res.json();
                const followersList = document.querySelector('#followers');
                
                data.forEach(follower => {
                    const followerHtml = `
                    <li>
                        <img src="${follower.avatar_url}" width="30" height="30" style="border-radius:50%">
                        <a href="user.html?username=${follower.login}">${follower.login}</a>
                    </li>
                    `;
                    followersList.innerHTML += followerHtml;
                });
            } catch (err) {
                console.error(err);
            }
        }

        async function loadFollowing(username) {
            try {
                const res = await fetch(`https://api.github.com/users/${username}/following`, {
                    headers: {
                        'Authorization': 'Bearer ' + GITHUB_ACCESS_TOKEN
                    }
                });

                if (!res.ok) {
                    throw 'Server error occurred, status code:' + res.status;
                }
                const data = await res.json();
                const followingList = document.querySelector('#following');
                
                data.forEach(user => {
                    const userHtml = `
                    <li>
                        <img src="${user.avatar_url}" width="30" height="30" style="border-radius:50%">
                        <a href="user.html?username=${user.login}">${user.login}</a>
                    </li>
                    `;
                    followingList.innerHTML += userHtml;
                });
            } catch (err) {
                console.error(err);
            }
        }

        const params = new URLSearchParams(window.location.search);
        const username = params.get('username');

        if (!username) {
            window.location = 'index.html';
        }

        loadUserProfile(username);
        loadRepositories(username);
        loadFollowers(username);
        loadFollowing(username);
    </script>
</body>
</html>